@using TesterProject.DataAccess.Utils  

@inject SessionState Session  
@inject AuthService AuthService  
@inject NavigationManager Nav  
@inject ILogin Login  
@layout EmptyLayout  

@code {  

    [Parameter] public string Ruta { get; set; } = "";  
    [Parameter] public RenderFragment? ChildContent { get; set; }  

    bool? userPermitido = false;  
    protected override void OnInitialized()  
    {  
        List<int> rolesPermitidos = Login.GetRolesPermitidosParaPagina(Ruta);  
        userPermitido = Session.UsuarioActual?.Roles.Any(r => rolesPermitidos.Contains(r.Id));  
        if (Session.UsuarioActual == null || !Session.IsAuthenticated || !userPermitido.Value)  
        {  
            Nav.NavigateTo("/unauthorized");  
        }  
    }  
}  

@if (Session.IsAuthenticated && userPermitido.Value)  
{  
    @ChildContent  
}